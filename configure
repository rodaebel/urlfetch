#!/bin/sh

BASENAME=`basename $0`

. config.ini

usage() {
   echo "Usage: $BASENAME [options]";
}

log() {
   printf "$1"
   printf "$1" >> $LOGFILE
}

error_exit() {
   msg="$BASENAME: error: $2"
   echo "$msg" 1>&2
   echo "$msg" >> $LOGFILE
   exit $1
}

for _option
do

   # If the previous option needs an argument, assign it.
   if test -n "$_prev"; then
      eval "$_prev=\$_option"
      _prev=
      continue
   fi

   case "$_option" in
   -*=*) _optarg=`echo "$_option" | sed 's/[-_a-zA-Z0-9]*=//'` ;;
   *) _optarg= ;;
   esac

   case "$_option" in

   --help | -h)
      usage;
      cat << EOF

Options:
   -h,--help    display this message

EOF
   exit 0;;

   --* | -* ) { echo "$BASENAME: error: $_option: invalid option; use --help to show usage" 1>&2; exit 1; };;
   * )
      args="$args$_option " ;;

   esac
done

cat >$LOGFILE << EOF
Created by $PACKAGE configure.

$ $0 $@

EOF

#
# Check erlang version
#
log "checking for Erlang OTP version ... "
ERL_PATH=`which erl`
if [ "$ERL_PATH" = "" ]; then
    error_exit 1 "no Erlang (BEAM) emulator found";
fi
OTP_RELEASE=`erl -noshell -eval 'io:fwrite(erlang:system_info(otp_release)), init:stop().'`
log "${OTP_RELEASE}\n"

#
# Create makefile
#
log "creating: Makefile\n";
cat Makefile.in | sed \
   -e "s,@PACKAGE@,${PACKAGE}," \
   > Makefile

exit 0;
